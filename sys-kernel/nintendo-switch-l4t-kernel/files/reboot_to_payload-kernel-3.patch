From d55163ee0b1aa14560284a3ed9b90dd3c81f86db Mon Sep 17 00:00:00 2001
From: Ezekiel Bethel <zek@9net.org>
Date: Thu, 8 Aug 2019 04:21:20 +0100
Subject: [PATCH] add sysfs

---
 drivers/soc/tegra/pmc-reboot2payload.c | 24 +++++++++++++++++++++---
 1 file changed, 21 insertions(+), 3 deletions(-)

diff --git a/drivers/soc/tegra/pmc-reboot2payload.c b/drivers/soc/tegra/pmc-reboot2payload.c
index 11800164eb1c..c0c6525cc346 100644
--- a/drivers/soc/tegra/pmc-reboot2payload.c
+++ b/drivers/soc/tegra/pmc-reboot2payload.c
@@ -81,8 +81,6 @@ static int reboot_to_payload_driver_probe(struct platform_device *pdev)
 			memcpy(iram_write_buff, reboot_payload_fw->data + i, copy_size);
 			ams_iram_copy(iram_write_buff, iram_payload_base + i, 0x1000, 0);
 		}
-
-		ams_reboot_to_payload();
 	}
 	else
 	{
@@ -91,6 +89,25 @@ static int reboot_to_payload_driver_probe(struct platform_device *pdev)
 	return 0;
 }
 
+ssize_t reboot_sysfs_store(struct device *dev, struct device_attribute *attr, const char *buf, size_t count)
+{
+	ams_reboot_to_payload();
+	return 1;
+}
+
+static struct device_attribute reboot_sysfs = __ATTR_WO(reboot_sysfs);
+static struct attribute *attrs[] = {
+    &reboot_sysfs.attr,
+    NULL,
+};
+static struct attribute_group attr_group = {
+    .attrs = attrs,
+};
+static const struct attribute_group *attr_groups[] = {
+    &attr_group,
+    NULL
+};
+
 static const struct of_device_id tegra_reboot_to_payload_match[] = {
 	{ .compatible = "tegra-reboot2payload", },
 	{ }
@@ -101,7 +118,8 @@ static struct platform_driver tegra_reboot_to_payload_driver = {
 	.driver  = {
 		.name  = "tegra-reboot2payload",
 		.owner = THIS_MODULE,
-		.of_match_table = tegra_reboot_to_payload_match
+		.of_match_table = tegra_reboot_to_payload_match,
+		.groups = attr_groups
 	},
 };
 
-- 
2.21.0

